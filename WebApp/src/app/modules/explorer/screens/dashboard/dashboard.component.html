<div class="container">
  <div class="header">
    <div class="title">
      <h1>Media</h1>
      <h4>Administra el contenido multimedia en la plataforma</h4>
    </div>
    <button
      (click)="openCreateFolderDialog()"
      mat-raised-button
      color="primary"
    >
      <mat-icon>add</mat-icon>
      <span> Añadir </span>
    </button>
  </div>
  <div id="summaries">
    <dashboard-block
      title="Resumen"
      subtitle="Total"
      color="rgb(59, 130, 246)"
      [count]="totalCount"
    ></dashboard-block>
    <dashboard-block
      title="Resumen"
      subtitle="Imágenes"
      color="rgb(34, 197, 94)"
      [count]="imageCount"
    ></dashboard-block>
    <dashboard-block
      title="Resumen"
      subtitle="Videos"
      [count]="videoCount"
      color="rgb(245, 158, 11)"
    ></dashboard-block>
    <dashboard-block
      title="Resumen"
      subtitle="Archivos"
      [count]="fileCount"
      color="rgb(239, 68, 68)"
    ></dashboard-block>
  </div>

  <div class="file-explorer mat-elevation-z4">
    <folder-tree
      (onFolderClicked)="getMediaInFolder($event)"
      [currentFolderName]="currentFolderName"
      [folderStack]="folderStack"
    ></folder-tree>
    <actions-menu
      [filesToMove]="filesToMove"
      [selectedRows]="selectedRows"
      (onCancelClicked)="cancelMove()"
      (onMoveFilesClicked)="moveFilesClicked()"
      (onMoveFilesConfirm)="moveFilesHere()"
    ></actions-menu>
    <div
      [ngClass]="{ 'drag-container': isDraggingFiles }"
      (dragover)="dragFilesStart($event)"
      (dragleave)="dragFilesStop($event)"
      (dragend)="dragFilesStop($event)"
      (drop)="dropFiles($event)"
      class="table-container table-responsive drag-drop"
    >
      <table [dataSource]="dataSource" mat-table>
        <ng-container matColumnDef="name">
          <th mat-header-cell class="min-w-[150px]" *matHeaderCellDef>
            Nombre
          </th>
          <td mat-cell *matCellDef="let element">
            <div class="name-container">
              <mat-icon
                [ngStyle]="{
                  color: MediaResourceTypeUtils.getColor(element.resourceType),
                }"
              >
                {{ MediaResourceTypeUtils.getIcon(element.resourceType) }}
              </mat-icon>
              {{ element.name }}
            </div>
          </td>
        </ng-container>

        <ng-container matColumnDef="lastModified">
          <th mat-header-cell class="min-w-[150px]" *matHeaderCellDef>
            Última modificación
          </th>
          <td mat-cell *matCellDef="let element">
            <div
              class="name-container flex items-center gap-2 secondary-text-color-text"
            >
              {{ DateUtils.getShortDateWithTime(element.dateUpdated) }}
            </div>
          </td>
        </ng-container>

        <ng-container matColumnDef="more" stickyEnd>
          <th
            mat-header-cell
            class="background-bg text-center"
            *matHeaderCellDef
          >
            <span> Más </span>
          </th>
          <td mat-cell class="more-cell" *matCellDef="let element">
            <button
              (click)="$event.stopPropagation()"
              mat-icon-button
              [matMenuTriggerFor]="mediaMenu"
              [matMenuTriggerData]="{ media: element }"
            >
              <mat-icon class="secondary-text-color-text"> more_vert </mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr
          mat-row
          *matRowDef="let row; columns: displayedColumns; let i = index"
          [ngClass]="{ 'row-selected': isRowSelected(row.id) }"
          (click)="onRowSelected(row, i)"
          class="relative hover:hover-bg cursor-pointer transition-colors"
        ></tr>
      </table>

      @switch (mediaStatus) {
        @case (Status.loading) {
          <div
            class="flex flex-row w-full items-center justify-center h-[75px]"
          >
            <mat-spinner [diameter]="30"></mat-spinner>
          </div>
        }
        @case (Status.empty) {
          <div class="empty">
            <empty-message></empty-message>
          </div>
        }
      }
    </div>
  </div>
</div>

<mat-menu #mediaMenu="matMenu">
  <ng-template matMenuContent let-media="media">
    <button (click)="deleteClicked(media)" mat-menu-item>Eliminar</button>
  </ng-template>
</mat-menu>
